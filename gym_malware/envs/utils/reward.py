import pyclamd
from config import *

# 运行前启动clamd.exe
class ClamAV():
    def __init__(self):
        self.cd = pyclamd.ClamdAgnostic()

    def scan(self, sample):
        if type(sample) == bytes:
            result = self.cd.scan_stream(sample)
        else:
            result = self.cd.scan_file(sample)
        return 0 if result == None else 1

def label_function(sample):
    reward = ClamAV()
    return reward.scan(sample)

def test_pyclamd():
    c = pyclamd.ClamdAgnostic()
    print('test pyclamd:', c.ping())

if __name__ == '__main__':
    test_pyclamd()
    sample_path = MAL_SAMPLE_PATH
    with open(sample_path, 'rb') as sp:
        sample = sp.read()
    print(label_function(sample))
